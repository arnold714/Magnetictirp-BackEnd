<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.trip.model.mapper.AttractionMapper">

        <!-- 관광지 정보 결과 매핑 -->
        <resultMap type="com.ssafy.trip.model.AttractionResponseDto" id="attractionResult">
            <result column="content_id" property="contentId"/>
            <result column="content_type_id" property="contentTypeId"/>
            <result column="title" property="title"/>
            <result column="addr1" property="addr1"/>
            <result column="addr2" property="addr2"/>
            <result column="first_image1" property="firstImage1"/>
            <result column="first_image2" property="firstImage2"/>
            <result column="area_code" property="areaCode"/>
            <result column="si_gun_gu_code" property="siGunGuCode"/>
            <result column="latitude" property="latitude"/>
            <result column="longitude" property="longitude"/>
        </resultMap>
    <sql id="search">
        <if test="area != null and area != ''">
            area_code = #{area}
        </if>
        <if test="theme != null and theme !=''">
            AND content_type_id = #{theme}
        </if>
        <if test="word != null and word != ''">
            AND title LIKE CONCAT('%', #{word}, '%')
        </if>
    </sql>
        <!-- 관광지 목록 조회 쿼리 (필터 적용) -->
        <select id="listAttraction" parameterType="map" resultMap="attractionResult">
            SELECT
            content_id,
            content_type_id,
            title,
            addr1,
            addr2,
            first_image1,
            first_image2,
            area_code,
            si_gun_gu_code,
            latitude,
            longitude
            FROM attractions
            <where>
                <include refid="search"></include>
            </where>
            ORDER BY content_id DESC
            LIMIT #{start}, #{size}
        </select>
    <select id="getTotalAttractionCount" parameterType="map" resultType="int">
        select count(no)
        from attractions
        <where>
            <include refid="search"></include>
        </where>
    </select>
    <!-- 시/도 이름 조회 쿼리 -->
    <select id="getSidoName" parameterType="int" resultType="String">
        SELECT sido_name FROM sidos WHERE sido_code = #{sidoCode}
    </select>

    <!-- 구/군 이름 조회 쿼리 -->
    <select id="getGugunName" parameterType="map" resultType="String">
        SELECT gugun_name FROM guguns WHERE sido_code = #{sidoCode} AND gugun_code = #{gugunCode}
    </select>

    <!-- 콘텐츠 타입 이름 조회 쿼리 -->
    <select id="getContentTypeName" parameterType="int" resultType="String">
        SELECT content_type_name FROM contenttypes WHERE content_type_id = #{contentTypeId}
    </select>
	<!--콘텐츠 타입 ID 조회  -->
	<select id="getContentTypeId" parameterType="int" resultType="String">
        SELECT content_type_id FROM attractions WHERE content_id = #{contentId}
    </select>
</mapper>
